{% extends "base.html" %}

{% block content %}
    <h2>Your Dashboard</h2>

    <div id="your-listings">
        {% for property in properties %}
            <div class="property">
                <h4>{{ property.title }}</h4>
                <p>{{ property.description }}</p>
                <p>Price: ${{ property.price }}</p>
                <p>Location: {{ property.location }}</p>
                <p>Number of Beds: {{ property.num_beds }}</p>
                <p>Amenities: {{ property.amenities }}</p>
                <p>Status: 
                    {% if property.status == 'Available' %}
                        <span style="color: green;">{{ property.status }}</span>
                    {% else %}
                        <span style="color: red;">{{ property.status }}</span>
                    {% endif %}
                </p>

                <!-- Edit Button triggers the modal -->
                <button class="btn btn-primary" onclick="openEditModal({{ property.id }}, '{{ property.title|escape }}', '{{ property.description|escape }}', {{ property.price }}, '{{ property.location|escape }}', {{ property.num_beds }}, '{{ property.amenities|escape }}', '{{ property.status }}')">Edit</button>

                <!-- Delete Button -->
                <form action="{{ url_for('delete_property', id=property.id) }}" method="POST" style="display:inline;">
                    <button type="submit" class="btn btn-danger">Delete</button>
                </form>
            </div>
        {% endfor %}
    </div>
    <!-- Modal for Editing a Property -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeEditModal()">&times;</span>
            <h2>Edit Property</h2>
            <form id="editPropertyForm" method="POST">
                <div>
                    <label for="editTitle">Property Title</label>
                    <input type="text" id="editTitle" name="title" required>
                </div>
                <div>
                    <label for="editDescription">Description</label>
                    <textarea id="editDescription" name="description" required></textarea>
                </div>
                <div>
                    <label for="editPrice">Price</label>
                    <input type="number" id="editPrice" name="price" required>
                </div>
                <div>
                    <label for="editLocation">Location</label>
                    <input type="text" id="editLocation" name="location" required>
                </div>
                <div>
                    <label for="editNumBeds">Number of Beds</label>
                    <input type="number" id="editNumBeds" name="num_beds" required>
                </div>
                <div>
                    <label for="editAmenities">Amenities</label>
                    <input type="text" id="editAmenities" name="amenities" placeholder="e.g., Wi-Fi, Air Conditioning">
                </div>
                <div>
                    <label for="editStatus">Status</label>
                    <select id="editStatus" name="status">
                        <option value="Available">Available</option>
                        <option value="Unavailable">Unavailable</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-success">Save Changes</button>
            </form>
        </div>
    </div>

    <div>
        <h3>Create a New Listing</h3>
        <form id="propertyForm" method="POST" action="{{ url_for('add_listing') }}">
            <div>
                <label for="title">Property Title</label>
                <input type="text" id="title" name="title" required>
            </div>
            <div>
                <label for="description">Description</label>
                <textarea id="description" name="description" required></textarea>
            </div>
            <div>
                <label for="price">Price</label>
                <input type="number" id="price" name="price" required>
            </div>
            <div>
                <label for="location">Location</label>
                <input type="text" id="location" name="location" required>
            </div>
            <div>
                <label for="num_beds">Number of Beds</label>
                <input type="number" id="num_beds" name="num_beds" required>
            </div>
            <div>
                <label for="amenities">Amenities</label>
                <input type="text" id="amenities" name="amenities" placeholder="e.g., Wi-Fi, Air Conditioning">
            </div>
            <button type="submit">Add Listing</button>
        </form>
    </div>
{% endblock %}



